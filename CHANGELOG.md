# 更新紀錄 (Changelog)
## [v2.11.2]
### 修改
 - 修正日誌設定 (Log Level) 邏輯：
   - 更改 localStorage Key 為 `log-system-debug-enabled` 以避免與舊版數值衝突。
   - 調整 `isDebugEnabled()` 優先權，確保 UI 的 Disable 設定能正確覆蓋 URL 參數。
   - 優化 `uiController.js` 初始化邏輯，避免在已存有設定的情況下被網址參數強制覆寫。
 - 代碼清理：
   - 移除 `uiController.js` 中過時的 `deepgram-enabled` 資料遷移與刪除邏輯。
   - 更新 `speechCapture.js` 檔案頂部描述註解。

## [v2.11.1]
### 修改
 - 移除 translateGemma (實驗功能) 的相關程式碼與 UI 選項，該功能已被 Custom URL 取代，藉此精簡專案體積與邏輯複雜度。

## [v2.11.0]
### 修改
 - 重構日誌系統 (Logger)，從包裝器模式改為動態判斷模式，解決瀏覽器除錯時行號顯示不正確的問題。
 - 簡化日誌設定，將原本的四個等級簡化為單純的「開啟/關閉」開關。
 - 將 `isDebugEnabled` 改為動態讀取函式，提升設定變更時的響應穩定性。
 - 在介面右下角加入版本號碼顯示，方便版本識別與維護。

## [v2.10.0]
### 新增
 - 實作 Google Translate Extension (GTX) 翻譯邏輯，提供更快速且免 API Key 的翻譯選項。
 - 將 GTX 翻譯模式設為系統預設值。

### 修改
 - 重構翻譯請求分流邏輯，新增對 GTX 模式的支援。
 - 優化 GTX 翻譯的錯誤處理，包含 429 Too Many Requests 的自動重試機制。
 - 將預設語音辨識引擎從 Deepgram 改為 Web Speech API (免費)。
 - 更新 UI 翻譯模式名稱，標註 GTX 為標準模式，並調整其他模式名稱以利識別。
 - 調整語音轉錄文字顯示的表情符號（針對 Chrome 環境）。

## [v2.9.2]
### 新增
 - 增加說明檔

### 修改
 - web speech api小修改
 - 移動web speech api on device的語言包下載位置，但因為這功能在Chrome還是實驗性質，直接使用還有問題，所以不開放，先移位置而已。


## [v2.8.17]
 - 修改deepgram的相關程式邏輯
 - 調整ModeB的一些參數


## [v2.8.15]
### 修改
 - 增加ray mode的關鍵字過濾表
 - 取消deepgram強制開啟的選項
 - 嘗試修正web speech api on device(chrome only)在剛安裝好之後一開始錄音時會卡住的問題，但因為同樣只是實驗性質所以隱藏下載

 
## [v2.8.11]
### 修改
 - 增加ray mode的關鍵字過濾表
 - 強制設定選項啟動時deepgram為開啟，目前deepgram經過調整後有穩定一些，所以暫時先強制開啟，之後會取消強制開啟的選項
   (後端沒給key時會直接跳過改走web speech api，所以除非有要使用否則不會受到影響)


## [v2.8.10]
### 修改
 - 調整deepgram的程式邏輯避免顯示有很奇怪的問題，但還是有一些問題要處理
 - 增加ray mode的關鍵字過濾表
 - 調整ray mode的運作模式
 - 修改ray mode的關鍵詞
 - 修改調整ray mode的運作模式造成的錯誤問題


## [v2.8.5]
### 修改
 - 調整自訂斷句處理的邏輯
 - 調整deepgram的斷句邏輯，簡化成兩個，一個是UtteranceEnd事件出現時重置和發送翻譯，另外一個是防止不明原因未斷句的計時器
 - deepgram的開啟邏輯重新改為不強制啟動關閉，選項設定哪一項就使用哪一個


## [v2.8.2]
### 修改
 - 調整ray mode的用語語句
 - 強制設定選項deepgram啟動時為關閉，因為實況時辨識率比web speech api還差，而且環境差異造成調整後差異太大很難微調，所以預設就取消。

## [v2.8.1]
### 新增
 - 加入translategemma的選項(測試用)
 
### 修改
 - web speech api加入自訂斷句處理的邏輯
 - 強制逐字稿最多呈現兩行、超過就往上捲動(預計之後會改成用在其他模式)
 - 調整deepgram和ray mode的用詞語句
 

## [v2.7.4]
### 修改
 - 調整deepgram的參數
 - 調整預定要加入的字幕面板參數
 - 修改翻譯字幕行數的選項和修正起始時不載入相關設定的問題

## [v2.7.2]
### 修改
 - 調整deepgram的參數


## [v2.7.1]

### 新增
 - 加入deepgram的多人人聲分離參數和相關邏輯(測試)

### 修改
 - 調整deepgram的參數


## [v2.6.13]

### 修改
 - 調整deepgram的參數
 - 修正edge的web speech api逐字稿有時只有顯示符號的問題


## [v2.6.11]

### 修改
 - 修正deepgram取得key失敗回頭走web speech api時逐字稿顯示的符號錯誤問題

## [v2.6.10]

### 修改
 - 調整prompt api的啟動程序，但保持不使用狀態。
 - 調整deepgram和getusermedia的參數。

## [v2.6.8]

### 修改
 - 暫時先將prompt api啟動的程序取消，待修復後再開啟。

## [v2.6.7]
### 新增
 - 加入deepgram使用的說明文件

### 修改
 - 修正發送雲端發送語言的代碼
 - 修正高速翻訳翻譯結果重複發送兩次的狀況
 - 調整外框字的呈現方式，理論上效能比較好實際應該差不多
 - 調整deepgram的一些運作方式
 - 調整預設值，強迫deepgram選項開啟(暫時性)
 - 修改符號讓其對應不同的API和瀏覽器
   deepgram api            → 🐹
   web speech api → Chrome → 🎵
   web speech api → Edge   → 🎼️

 - 修正如果是觀看其他麥克風資訊的時候遮罩沒有遮到的問題


## [v2.5.4]
### 新增
 - 程式碼大整理

### 修改
 - 調整說明文件的說明
 - 繼續調整響應式UI
 - 修改translator api的處理邏輯
 - 調整deepgram api的運作邏輯


## [v2.4.20]
### 新增
 - 加入除錯訊息的選項，除錯用
 - 增加製作翻譯後端的方式連結

### 修改
 - 避免瀏覽器的密碼管理員強制要求存檔，將雲端URL部分從PASSWORD修改成TEXT，但遮蔽依舊保持避免直播的時候進行設定洩漏資訊
 - 調整響應式UI
 - 調整deepgram運作邏輯


## [v2.2.17]
### 新增
 - 加入アドバンスド音声認識設定選項，服務為deepgram，預設關閉因為這個服務要錢並且要和後端程式碼配合
   補充: 還在測試階段所以選項先不可選擇。

### 修改
 - 將GAS和雲端的輸入攔分離，這樣方便直接切換不用重新輸入
 - 修改高速翻譯的使用邏輯
 - 修改使用Edge時的語音擷取文字標點符號方式，和Chrome統一都使用空格、由翻譯引擎來進行辨識
 - 修改發送雲端翻譯URL的請求格式、增加前文


## [v2.1.13]
### 新增
 - 增加遮蔽麥克風資訊的按鈕功能
 - 增加遮蔽API文字、並且可以切換顯示隱藏的功能
 - 增加點擊字幕面板讓全視窗都是顯示字幕的功能，並且加入選項開啟關閉這功能
 - 增加@Media響應式CSS避免版面縮減造成頁面位置不正確

### 修改
 - UI大幅調整
   將聲音認識和翻譯語言字幕設定集中在同一頁面
   其他設定UI卡片化
   翻譯方式選項修改為下拉式選單避免混淆，翻訳リンク名稱修改成為翻訳クラウド接続
   狀態列放至最下方
   最小化按鈕移除、增加點擊字幕處面板讓其最大化，並增加功能是否要使用的選項
   れいーモード新增勾選選項讓其便於辨識是否有開啟
 - 將聲音認識的字幕強制單行顯示從れいーモード移出，並且加入選項開關
 - 修改強制單行顯示的處理方式，從原本計算字數的方式改用CSS拉開行距並強制停在最後一行的方式來達成效果
 - 修正翻譯文字如果超過面板高度的時候，會自己開始擠壓的狀況


---

## [v1.10.49] -
### 新增
 - 加入偵測預設麥克風和其他麥克風的功能，不能修改但是可以顯示出來讓使用者知道預設麥克風是不是選擇錯誤
  
### 修改
 - 調整prompt api第一次執行時的檢測和下載進度的說明
 - CSS增加IDE建議的相容性屬性
 - 修正translator api的編碼轉換重複的問題
 - 修改一些prompt api的程式碼部分邏輯
 - 停止錄音之後修改成會將目前顯示的字幕清除，因為abort比stop要穩定一些
 - 語言包的部分先阻擋繁體中文的離線模組下載，因為測試後有很多問題，問題寫在語言包下載的檔案相關函式上方
 - 支援使用localhost的後端，雖然不是很好的做法但是使用後端會比較方便一點


---

## [v1.9.42] -
### 新增
 - 由於不導入第三方工具軟體，所以就讓Chrome在使用高速翻譯的時候，將語音擷取的語句之間的空格加入簡易的判斷規則注入標點符號，盡可能讓他翻譯品質稍微好一點點
   但還是完全不建議使用那個高速翻譯...品質真的不好，就算是這樣做過預處裡也是很差，除非給AI先整理語句之後再使用這個翻譯會好一點
   但既然給AI整理語句了，那乾脆直接用AI去翻譯不是更好...
   就等待prompt api甚麼時候從預覽功能出關吧，雖然現在是可以用但不知道會不會影響到直播，因為會消耗GPU運算

### 修改
 - 修正瀏覽器辨識因大小寫辨識錯誤的問題
 - 移除一些沒用到的程式碼
 - 移除自動重啟錯誤時的stop參數
   因為理論上這樣用會造成和onend事件的重啟衝突，但大多數狀況都是物件本身就還是啟動狀態才會產生錯誤，所以有可能移除後反而造成一直出現重啟錯誤
   但這要觀察才知道，因為目前只有onend事件才會啟動重啟，有onend事件就表示已經停止了，就算重啟動失敗她還是停止狀態就不會一直出現錯誤..理論上
 - 修正UI控制的js初始化重複載入的問題
 - 調整prompt api的初始化邏輯，並且修改名稱改為ブラウザAI
 - 調整部分初始化的載入方式，先讓一些參數掛載完再跑後面的程序
 - 修改停止按鍵的事件中stop參數的邏輯，修改為abort，這兩個差異在一個是停下會回傳結果，一個是停下也拒絕結果
   這一個會修改主要是測試的狀況是stop有些時候沒辦法將語音停止，造成啟動的時候也出現正在啟動中的錯誤沒辦法啟動，這樣造成了穩定性的問題
   所以直接採用abort來停止語音辨識，abort會強制停止後傳送onerror事件，這個事件之後會自動轉到onend事件，理論上這樣比較穩定，實際上不知還要再觀察
 - 修正初次使用時translator api下載模型時的邏輯錯誤問題

---

## [v1.8.34] - 
### 新增
- 加入本地語言模型可以使用時的短語加成列表，現在還不能使用，要等本地語言模型可以使用時才能使用(程式碼先做出來等支援，還早)

### 修改
- 修改chrome的本地語言模型下載語言，從中文修改成日文，但因為我不懂日文所以只能慢慢修改...
- 加入瀏覽器的建議增加可以提升SEO的html語句...完全沒必要不過既然看到建議就加入了
- 將NEW API名稱修改為高速翻譯，速度是最快沒錯不過那翻譯水準實在是...
- 清除多餘匯出匯入的模組
- 調整web speech api的語音物件的參數使用方式
- 調整最終結果後的語音重啟時間參數，因為簡化後發現重啟時間可以拉低不會造成影響，重啟失敗間隔邏輯修改
- 修改中國語(香港)聲音認識的方式改成粵語，但翻譯顯示還是書面語
- 將最小化設定儲存的功能取消，因為好像造成困擾了
- 顯示的文字顏色調色盤加入部分快速色彩選擇

---

## [v1.7.25] - 
### 新增
- 無

### 修改
- 移除kuromoji.js的所有相關檔案和程式碼邏輯，因為在正式使用的地方無法使用，原因不明
- 修正使用prompt api時語言代碼不正確的問題
- 整理部分程式碼
- 因為各種原因重啟時加入啟動的參數，因為發現不加入參數好像重啟時可能會有問題，但本地語音模型好像會有延遲狀況，調查中
- 移除onerror事件出現時呼叫重啟的功能，因為產生的同時會出現onend事件，同時重啟的話會造成錯誤所以先移除看狀況決定怎麼做
- 修改使用字型、從放入的JF OPEN 粉圓 2.1修改為從外部調入Google Font

---

## [v1.7.19] - 2025-09-26
### 新增
- 因應之後可以使用的本地模型重新加入分詞工具kuromoji，但還是有可能會移除因為效果一直不佳。

### 修改
- 修改字幕顯示到畫面上的相關邏輯、降低瀏覽器負擔
- 修改recognition參數procLocal的相關程式碼邏輯，改為除非本地端模型可以正常使用，否則一律使用連線方式，並且依照此數值判斷參數continuous的布林值
- 移除部分沒使用到的程式碼，包含看門狗
- 移除一些之前修改後沒有使用到的參數
- 修正文字靠右時偽元素和原始文字分離的狀況
- 修改翻譯文字選擇顯示一行時語音文字也只顯示一行最後都是...的狀況

---

## [V1.6.9] - 2025-09-20
### 新增
- 加入實驗性情境引導，測試用有沒有效果不知(由於之後的chrome版本似乎會造成出錯，所以先註解掉避免出問題)
- 加入web speech api新出的本地模型相關程式碼，但可能是chrome的問題，要到142版之後才能正常使用，所以相關按鍵都先隱藏起來避免出問題

### 修改
- 將原本重置SpeechRecognition這個造成更多問題的邏輯取消掉，先註解掉後面再觀察狀況，有比較好就直接移除了
- 整理一些被AI弄亂的程式碼，只有整理一些...

題外話: 本地執行和連線到Google伺服器的穩定性差太多了...強烈建議等這個功能穩定之後就主打這使用方式

---

## [V1.5.8] - 2025-09-20
### 新增
- 加入實驗性prompt API功能，但還有很多問題所以暫時先放著程式碼不使用
- 移除kuromoji分詞工具，因為沒有成功緩解長時間使用崩潰問題，那使用就沒有意義了
- 加入部分web speech api新出的本地模型相關程式碼，後續會更新，可能...

### 修改
- 修正狀態攔的文字顯示位置錯誤的狀況
- 看門狗機制先取消，因為要觀察到底是哪邊造成的卡住問題
- edge會有っ。的訊息出現，加入跳過這一個訊息翻譯的狀況

---

## [V1.4.5] - 2025-09-19
### 新增
- 移除文字翻譯功能，就觀察應該是完全不會使用到，並且NEW API翻譯品質不佳，沒有使用較大型AI模型翻譯的時候使用此功能完全沒有意義，還不如使用Google翻譯
- 加入Prompt API按鈕，實驗性質，和NEW API按鍵是二選一，功能等之後再做，現在要開啟一大堆實驗性設定才能用。
- 暫時先導入kuromoji分詞工具，等Chrome標準通道141版或142版出來之後可能會移除，因為主要導入是用在緩解Translator API長時間使用會崩潰的問題，確定141版後會修復。

### 修改
- UI微調，因為移除文字翻譯功能，所以將NEW API按鈕移到選單處。
- 除錯紀錄中有一個訊息會曝露翻譯連結，依照AI建議將其移除。
- 最小化按鈕移到左邊
- 加入看門狗機制，避免chrome可能因為伺服器回應速度太慢造成語音辨識卡住的狀況，或許可以解決。

---

## [V1.3.6] - 2025-09-03
### 新增
- 最小化時用的開始錄音和停止錄音按鍵

### 修改
- ray mode的關鍵字替換增加
- 修改Chrome Translator API更新顯示的方式、從原本的輪流更新變成一次一起更新，有好有壞
- 由於已實作最小化的錄音啟動相關按鈕，所以讓最小化按鈕可以儲存狀態
- 修正status panel在頁面縮小時也會縮小的狀況、加入min-height而已
- 修正字幕太多會蓋住UI的狀況
- 修改その他選項內的項目位置、之後還會再修改，預計將NEW API的按鍵放到這裡面

---

## [V1.2.3] - 2025-08-26
### 新增
- 新增Chrome Translator API 的翻譯實作(實驗性質)
- 留言翻譯新增將留言發送到字幕的功能，也會一起進行翻譯 (尚未完善)
- 新增狀態攔，顯示各種訊息用
- 新增最小化按鈕，隱藏控制面板以便讓顯示面板能夠顯示更多字

### 修改
- 部分原本是發送到來源語言的錯誤訊息修改成發送到狀態攔
- 修正不定時翻譯結果不顯示的問題 (不保證修復，因為是不定時所以這邊其實找不到到問題點，只能先嘗試一些地方的邏輯做修改看看)
- 修復文字翻譯框將版面撐過頭的問題
- 日語部分在使用Chrome Translator API時，嘗試使用標點符號替換空格，以避免過多翻譯被省略的狀態

---

## [1.0.6] - 2025-08-17
### 新增
- 修正ray mode的關鍵字替換表每一次都重新調用改為先載入到記憶體中
- 修改增加ray mode的關鍵字過濾表
- 在普通模式下文字的左右也增加音符，方便辨識有沒有產生結果發送翻譯